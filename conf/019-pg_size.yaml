#-------------------------------------------------------------#
# pg_size
# total sizes
# pg_ls_waldir and pg_ls_log_dir is available since PostgreSQL 10
#-------------------------------------------------------------#

pg_size:
  query: |
    SELECT (SELECT (coalesce(sum(size), 0)) FROM pg_ls_logdir())          AS log,
           (SELECT coalesce(sum(size), 0) FROM pg_catalog.pg_ls_waldir()) AS wal,
           (SELECT sum(pg_database_size(oid)) FROM pg_database)           AS database;

  ttl: 100
  tags: [cluster]
  min_version: 100000
  skip_errors: true
  metrics:
    - log:
        usage: GAUGE
        description: database log file size in bytes
    - wal:
        usage: GAUGE
        description: WAL file size in bytes
    - database:
        usage: GAUGE
        description: all database size in bytes

